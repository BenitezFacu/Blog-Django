{% extends "base.html" %}
{% block page_title %}
    <div style="text-align: center;">
        <h2 style="color: #cc9966 !important;">{{ post.title }}</h2>
    </div>
{% endblock page_title %}
{% block page_content %}
    <div style="max-width: 800px; margin: 0 auto; padding: 20px;">
        <div style="text-align: center; margin-bottom: 20px;">
            <small style="color: white !important;">
                {{ post.created_on.date }} | Categoría:
                {% for category in post.categories.all %}
                    <a href="{% url 'blog_category' category.name %}" style="color: #cc9966 !important; text-decoration: none !important;">
                        {{ category.name }}
                    </a>
                {% endfor %}
            </small>
        </div>
        
        <div style="text-align: center; margin-bottom: 30px;">
            <p style="color: white !important;">{{ post.body | linebreaks }}</p>
        </div>
        
        {% if post.has_media %}
            <div style="text-align: center; margin-bottom: 40px;">
                {% if post.is_image %}
                    <div style="display: inline-block;">
                        <img src="{{ post.media_file.url }}" 
                             alt="Imagen del post {{ post.title }}" 
                             style="max-width: 100%; max-height: 500px; border: 2px solid #ddd; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                    </div>
                
                {% elif post.is_video %}
                    <div style="display: inline-block;">
                        <video controls style="max-width: 100%; max-height: 400px; border: 2px solid #ddd; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                            <source src="{{ post.media_file.url }}" type="video/mp4">
                            <source src="{{ post.media_file.url }}" type="video/avi">
                            Your browser does not support the video tag.
                        </video>
                    </div>
                
                {% elif post.is_audio %}
                    <div>
                        <p style="color: white;"><strong>🎵 Audio del post:</strong></p>
                        <audio controls style="max-width: 500px; width: 100%;">
                            <source src="{{ post.media_file.url }}" type="audio/mpeg">
                            <source src="{{ post.media_file.url }}" type="audio/wav">
                            Your browser does not support the audio element.
                        </audio>
                    </div>
                
                {% elif post.is_document %}
                    <div>
                        <p style="color: white;"><strong>📄 Documento adjunto:</strong></p>
                        <a href="{{ post.media_file.url }}" 
                           target="_blank" 
                           style="display: inline-block; padding: 12px 24px; background: #007bff; color: white; text-decoration: none; border-radius: 5px; margin: 10px;">
                            📄 Ver/Descargar Documento
                        </a>
                        <br><small style="color: white;">Se abre en nueva pestaña</small>
                    </div>
                
                {% else %}
                    <div>
                        <p style="color: white;"><strong>📎 Archivo adjunto:</strong></p>
                        <a href="{{ post.media_file.url }}" 
                           target="_blank" 
                           style="display: inline-block; padding: 12px 24px; background: #6c757d; color: white; text-decoration: none; border-radius: 5px; margin: 10px;">
                            💾 Descargar Archivo
                        </a>
                    </div>
                {% endif %}
            </div>
        {% endif %}
    </div>
    
    <!-- Sección de comentarios centrada -->
    <div style="max-width: 1600px; margin: 40px auto 0; padding: 20px;">
        <h3 style="text-align: center; margin-bottom: 30px; color: #cc9966 !important;">Deja un comentario:</h3>
        
        <form method="post" style="background: rgba(26, 26, 26, 0.95); color: white; padding: 50px 60px; border: 2px solid #333; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.3);">
            <style>
                form input[type="text"], form textarea {
                    width: 100% !important;
                    box-sizing: border-box !important;
                    padding: 12px !important;
                    border: 1px solid #555 !important;
                    border-radius: 5px !important;
                    background: #2a2a2a !important;
                    color: white !important;
                    font-size: 16px !important;
                }
                form input[type="text"]:focus, form textarea:focus {
                    outline: none !important;
                    border-color: #cc9966 !important;
                }
            </style>
            {% csrf_token %}
            
            {% if form.non_field_errors %}
                <div style="background: #f8d7da; color: #721c24; padding: 15px; border-radius: 5px; margin-bottom: 20px; border: 1px solid #f5c6cb;">
                    {% for error in form.non_field_errors %}
                        {{ error }}
                    {% endfor %}
                </div>
            {% endif %}
            
            <div style="margin-bottom: 30px;">
                <label for="{{ form.author.id_for_label }}" style="font-weight: bold; display: block; margin-bottom: 12px; color: white;">Nombre:</label>
                {{ form.author }}
            </div>
            
            <div style="margin-bottom: 40px;">
                <label for="{{ form.body.id_for_label }}" style="font-weight: bold; display: block; margin-bottom: 12px; color: white;">Comentario:</label>
                {{ form.body }}
            </div>
            
            <div style="text-align: center;">
                <button type="submit" style="background: #cc9966; color: white; border: none; padding: 15px 40px; font-size: 16px; font-weight: bold; border-radius: 5px; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.2);">
                    Enviar Comentario
                </button>
            </div>
        </form>
    </div>
    
    <!-- Sección de comentarios existentes -->
    <div style="max-width: 800px; margin: 40px auto 0; padding: 20px;">
        <h3 style="text-align: center; margin-bottom: 30px; color: #cc9966;">Comentarios:</h3>
        
        {% for comment in comments %}
            <div style="border-bottom: 1px solid #ddd; padding-bottom: 20px; margin-bottom: 30px;">
                <p style="text-align: center; margin-bottom: 15px;">
                    <small style="color: white;">
                        En {{ comment.created_on.date }} <strong style="color: #cc9966;">{{ comment.author }}</strong> escribió:
                    </small>
                </p>
                
                {% if comment.body %}
                    <div style="text-align: center; margin-bottom: 15px;">
                        <p style="color: white;">{{ comment.body | linebreaks }}</p>
                    </div>
                {% endif %}
                
                {% if comment.has_media %}
                    <div style="text-align: center;">
                        {% if comment.is_image %}
                            <div style="margin-bottom: 15px;">
                                <p style="color: white;"><strong style="color: #cc9966;">{{ comment.author }}</strong> compartió una imágen 📸:</p>
                                <img src="{{ comment.media_file.url }}" 
                                     alt="Image shared by {{ comment.author }}" 
                                     style="max-width: 400px; max-height: 300px; cursor: pointer; border: 2px solid #ddd; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);" 
                                     onclick="openImageModal('{{ comment.media_file.url }}', '{{ comment.author }}')">
                                <br><small style="color: white;">Click to enlarge</small>
                            </div>
                        
                        {% elif comment.is_video %}
                            <div style="margin-bottom: 15px;">
                                <p style="color: white;"><strong style="color: #cc9966;">{{ comment.author }}</strong> compartió un video 🎬:</p>
                                <video controls style="max-width: 400px; border: 2px solid #ddd; border-radius: 8px;">
                                    <source src="{{ comment.media_file.url }}" type="video/mp4">
                                    <source src="{{ comment.media_file.url }}" type="video/avi">
                                    Your browser does not support the video tag.
                                </video>
                            </div>
                        
                        {% elif comment.is_audio %}
                            <div style="margin-bottom: 15px;">
                                <p style="color: white;"><strong style="color: #cc9966;">{{ comment.author }}</strong> compartió un audio 🎵:</p>
                                <audio controls style="max-width: 400px; width: 100%;">
                                    <source src="{{ comment.media_file.url }}" type="audio/mpeg">
                                    <source src="{{ comment.media_file.url }}" type="audio/wav">
                                    Your browser does not support the audio element.
                                </audio>
                            </div>
                        
                        {% elif comment.is_document %}
                            <div style="margin-bottom: 15px;">
                                <p style="color: white;"><strong style="color: #cc9966;">{{ comment.author }}</strong> compartió un documento 📄:</p>
                                <a href="{{ comment.media_file.url }}" 
                                   target="_blank" 
                                   style="display: inline-block; padding: 8px 16px; background: #007bff; color: white; text-decoration: none; border-radius: 5px;">
                                    📄 View/Download Document
                                </a>
                                <br><small style="color: white;">Opens in new tab</small>
                            </div>
                        
                        {% else %}
                            <div style="margin-bottom: 15px;">
                                <p style="color: white;"><strong>📎 Shared a file:</strong></p>
                                <a href="{{ comment.media_file.url }}" 
                                   target="_blank" 
                                   style="display: inline-block; padding: 8px 16px; background: #6c757d; color: white; text-decoration: none; border-radius: 5px;">
                                    💾 Download File
                                </a>
                            </div>
                        {% endif %}
                    </div>
                {% endif %}
            </div>
        {% empty %}
            <p style="text-align: center; color: white;">No hay comentarios todavía. Puedes ser el primero en comentar!</p>
        {% endfor %}
    </div>
{% endblock page_content %}